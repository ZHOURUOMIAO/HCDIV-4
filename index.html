<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <style>
    body {
      background: linear-gradient(to bottom, #d0f0c0, #a8dba8); /* 设置浅绿色渐变背景 */
      font-family: Arial, sans-serif; /* 设置网页的字体 */
    }
    #map {
      width: 100%;  /* 保持地图宽度为100% */
      height: 800px;  /* 增大地图的高度 */
    }
    h1 {
      text-align: center; /* 将标题居中 */
      font-size: 28px; /* 将标题字体改小 */
      margin-top: 30px; /* 增加顶部间距 */
    }
    p {
      text-align: center; /* 将说明文字居中 */
      font-size: 18px; /* 适当增大说明文字的字体 */
      color: #4f4f4f; /* 将说明文字颜色设置为深灰色 */
      margin-top: 10px; /* 增加说明文字的顶部间距 */
    }
  </style>
</head>
<body>
  <h1>Population distribution map of Singapore (2023)</h1> <!-- 增大标题 -->
  <p>This map shows the population distribution of each street in Singapore. The shade of green indicates the population. The darker the green, the more people there are. The lighter the green, the less people there are.</p> <!-- 新增说明文字 -->
  <svg id="map"></svg>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    let width = 1000, height = 800;  /* 增大地图的高度 */

    let svg = d3.select("#map")
        .attr("viewBox", "0 0 " + width + " " + height);

    // 加载外部数据
    Promise.all([d3.json("sgmap.json"), d3.csv("population2023.csv")]).then(data => {
      let mapData = data[0].features;
      let popData = data[1];

      // 合并人口数据
      mapData.forEach(d => {
        let subzone = popData.find(e => e.Subzone.toUpperCase() == d.properties.Name);
        d.popdata = (subzone != undefined) ? parseInt(subzone.Population) : 0;
      });

      // 基于人口数据的颜色映射
      let colorScale = d3.scaleQuantize()
        .domain([0, d3.max(mapData, d => d.popdata)])
        .range(d3.schemeGreens[9]);  // 使用绿色渐变

      // 地图投影
      let projection = d3.geoMercator()
          .center([103.851959, 1.290270])
          .fitExtent([[20, 20], [980, 780]], data[0]);  /* 调整地图的适配区域，增大高度 */

      let geopath = d3.geoPath().projection(projection);

      svg.append("g")
          .attr("id", "districts")
          .selectAll("path")
          .data(mapData)
          .enter()
          .append("path")
          .attr("d", geopath)
          .attr("stroke", "black")
          .attr("fill", d => colorScale(d.popdata)) // 根据人口填充颜色
          .on("mouseover", function(event, d) {
            let tooltip = d3.select("body").append("div")
              .style("position", "absolute")
              .style("background", "rgba(255, 255, 255, 0.8)")
              .style("padding", "5px")
              .style("border", "1px solid #ccc")
              .style("border-radius", "5px")
              .text(d.properties.Name + ": " + d.popdata + " people");
            tooltip.style("left", (event.pageX + 10) + "px")
              .style("top", (event.pageY + 10) + "px");
          })
          .on("mouseout", function() {
            d3.select("body").select("div").remove();
          });
    });

  </script>
</body>
</html>
